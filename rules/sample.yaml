- name: checking_below_threshold
  when:
    condition: account.balance("Checking") < 50 # dollars; converted to milliunits
  notify: [pushover]

- name: checking_vs_card_due
  when:
    condition: account.balance("Checking") < account.due("CC_Main")
  notify: [pushover]

- name: cc_payment_readiness
  observe:
    capture_on: "5" # capture once per month on the 5th, adjust to billing day
    variable: cc_due_capture
    value: account.due("CC_Main")
  when:
    day_of_month: [14] # evaluate on the 14th, regardless of weekday
    condition: account.balance("Checking") < 0.8 * var.cc_due_capture
  notify: [pushover]

- name: first_monday_buffer
  when:
    nth_weekday: "1 Monday" # first Monday of the month
    condition: account.balance("Checking") < 100 # dollars
  notify: [log]

- name: weekly_friday_sweep
  when:
    days_of_week: ["Fri"]
    condition: account.balance("Savings") > 500 # dollars
  notify: [log]

- name: cron_based_check
  when:
    schedule: "0 9 14 * *" # 09:00 on the 14th of every month (cron standard)
    condition: account.balance("Checking") < account.due("CC_Main")
  notify: [pushover]

- name: month_end_check
  when:
    - day_of_month: [-1] # last day of the month
      condition: account.balance("Checking") < 100
  notify: [log]

- name: billing_window_readiness
  observe:
    - capture_on: "28" # record bill near end of month
      variable: bill_due
      value: 500
  when:
    - day_of_month_range: ["27-5"] # span 27th through 5th of next month
      condition: account.balance("Checking") < (var.bill_due + 200)
  notify: [log]

- name: two_cards_cover
  observe:
    - capture_on: "10"
      variable: card1_due
      value: account.due("Card1")
    - capture_on: "15"
      variable: card2_due
      value: account.due("Card2")
  when:
    - day_of_month: [-1] # last day
      condition: account.balance("Checking") < (var.card1_due + var.card2_due + 100)
  notify: [pushover]

- name: paycheck_buffer
  observe:
    - capture_on: "1"
      variable: rent_due
      value: 2000
  when:
    - days_of_week: ["Fri"]
      condition: account.balance("Checking") < (var.rent_due * 0.5) # mid-cycle buffer
    - day_of_month: [25]
      condition: account.balance("Checking") < (var.rent_due + 300) # rent + cushion before due
  notify: [log]
